---
title: React æ•ˆèƒ½å„ªåŒ–å·¥å…·èˆ‡å¥—ä»¶æŒ‡å—
description: é‡å° MAYO-PT-Web å°ˆæ¡ˆçš„ React æ•ˆèƒ½å„ªåŒ–å·¥å…·ã€å¥—ä»¶é¸æ“‡èˆ‡å¯¦ä½œå»ºè­°
tags: [React, æ•ˆèƒ½å„ªåŒ–, é–‹ç™¼å·¥å…·, ç›£æ§, æ¸¬è©¦]
published: 2025-10-14
draft: false
---

# React æ•ˆèƒ½å„ªåŒ–å·¥å…·èˆ‡å¥—ä»¶æŒ‡å—

> **æ–‡ä»¶ç‰ˆæœ¬ï¼š** v1.0
> **å»ºç«‹æ—¥æœŸï¼š** 2025-10-14
> **é©ç”¨å°ˆæ¡ˆï¼š** MAYO-PT-Web

---

## ğŸ“‹ ç›®éŒ„

1. [æ•ˆèƒ½åˆ†æå·¥å…·](#1-æ•ˆèƒ½åˆ†æå·¥å…·)
2. [é–‹ç™¼å·¥å…·](#2-é–‹ç™¼å·¥å…·)
3. [å„ªåŒ–å¥—ä»¶](#3-å„ªåŒ–å¥—ä»¶)
4. [æ¸¬è©¦å·¥å…·](#4-æ¸¬è©¦å·¥å…·)
5. [ç›£æ§å·¥å…·](#5-ç›£æ§å·¥å…·)
6. [å¯¦ä½œå»ºè­°](#6-å¯¦ä½œå»ºè­°)

---

## 1. æ•ˆèƒ½åˆ†æå·¥å…·

### 1.1 React DevTools Profiler

**ç”¨é€”ï¼š** åˆ†æ React çµ„ä»¶æ¸²æŸ“æ•ˆèƒ½

**å®‰è£ï¼š**
```bash
# Chrome/Firefox æ“´å……å¥—ä»¶
# ç›´æ¥å¾ç€è¦½å™¨å•†åº—å®‰è£ React Developer Tools
```

**ä½¿ç”¨æ–¹å¼ï¼š**
1. é–‹å•Ÿ React DevTools
2. åˆ‡æ›åˆ° "Profiler" æ¨™ç±¤
3. é»æ“ŠéŒ„è£½æŒ‰éˆ•
4. åŸ·è¡Œè¦åˆ†æçš„æ“ä½œ
5. åœæ­¢éŒ„è£½ä¸¦æŸ¥çœ‹çµæœ

**é—œéµæŒ‡æ¨™ï¼š**
- **Render duration** - çµ„ä»¶æ¸²æŸ“æ™‚é–“
- **Commit duration** - æäº¤åˆ° DOM çš„æ™‚é–“
- **Why did this render?** - æ¸²æŸ“åŸå› åˆ†æ

**ç¯„ä¾‹ï¼šåˆ†æ ShiftScheduleApproval**
```tsx
// åœ¨é–‹ç™¼ç’°å¢ƒä¸­ä½¿ç”¨ Profiler API
import { Profiler } from 'react';

const ShiftScheduleApprovalPage = () => {
  const onRenderCallback = (
    id: string,
    phase: "mount" | "update",
    actualDuration: number,
    baseDuration: number,
    startTime: number,
    commitTime: number,
  ) => {
    console.log(`${id} (${phase}) took ${actualDuration}ms`);
  };

  return (
    <Profiler id="ShiftScheduleApproval" onRender={onRenderCallback}>
      {/* çµ„ä»¶å…§å®¹ */}
    </Profiler>
  );
};
```

---

### 1.2 Why Did You Render

**ç”¨é€”ï¼š** æª¢æ¸¬ä¸å¿…è¦çš„çµ„ä»¶é‡æ–°æ¸²æŸ“

**å®‰è£ï¼š**
```bash
npm install --save-dev @welldone-software/why-did-you-render
# or
yarn add -D @welldone-software/why-did-you-render
```

**è¨­å®šï¼š**
```tsx
// src/wdyr.ts (åƒ…åœ¨é–‹ç™¼ç’°å¢ƒä½¿ç”¨)
import React from 'react';

if (process.env.NODE_ENV === 'development') {
  const whyDidYouRender = require('@welldone-software/why-did-you-render');
  whyDidYouRender(React, {
    trackAllPureComponents: true,
    trackHooks: true,
    logOnDifferentValues: true,
  });
}
```

**ä½¿ç”¨æ–¹å¼ï¼š**
```tsx
// åœ¨è¦è¿½è¹¤çš„çµ„ä»¶ä¸Šæ·»åŠ æ¨™è¨˜
const SearchBarFields: React.FC<SearchBarFieldsProps> = (props) => {
  // ... çµ„ä»¶é‚è¼¯
};

// é–‹ç™¼ç’°å¢ƒä¸‹å•Ÿç”¨è¿½è¹¤
SearchBarFields.whyDidYouRender = true;

export default SearchBarFields;
```

**è¼¸å‡ºç¯„ä¾‹ï¼š**
```
SearchBarFields re-rendered because:
  - props.departmentOptions changed
  - props.workHoursTypeOptions changed (but values are equal)
```

---

### 1.3 Chrome DevTools Performance

**ç”¨é€”ï¼š** æ·±å…¥åˆ†æç€è¦½å™¨æ•ˆèƒ½

**ä½¿ç”¨æ–¹å¼ï¼š**
1. é–‹å•Ÿ Chrome DevTools (F12)
2. åˆ‡æ›åˆ° "Performance" æ¨™ç±¤
3. é»æ“ŠéŒ„è£½æŒ‰éˆ•
4. åŸ·è¡Œè¦åˆ†æçš„æ“ä½œ
5. åœæ­¢éŒ„è£½ä¸¦æŸ¥çœ‹ç«ç„°åœ–

**é—œéµæŒ‡æ¨™ï¼š**
- **FPS** - æ¯ç§’å¹€æ•¸ï¼ˆç›®æ¨™ 60fpsï¼‰
- **CPU** - CPU ä½¿ç”¨ç‡
- **Main Thread** - ä¸»ç·šç¨‹æ´»å‹•
- **Memory** - è¨˜æ†¶é«”ä½¿ç”¨

---

## 2. é–‹ç™¼å·¥å…·

### 2.1 ESLint Plugin React

**ç”¨é€”ï¼š** éœæ…‹ä»£ç¢¼åˆ†æï¼Œæª¢æ¸¬æ•ˆèƒ½å•é¡Œ

**å®‰è£ï¼š**
```bash
npm install --save-dev eslint-plugin-react eslint-plugin-react-hooks
```

**è¨­å®šï¼š**
```json
// .eslintrc.json
{
  "extends": [
    "plugin:react/recommended",
    "plugin:react-hooks/recommended"
  ],
  "rules": {
    "react/jsx-no-bind": "warn",
    "react/no-array-index-key": "warn",
    "react-hooks/rules-of-hooks": "error",
    "react-hooks/exhaustive-deps": "warn"
  }
}
```

**æª¢æ¸¬é …ç›®ï¼š**
- âœ… Hooks ä¾è³´é …æª¢æŸ¥
- âœ… ä¸å¿…è¦çš„ re-render
- âœ… å…§è¯å‡½æ•¸è­¦å‘Š
- âœ… Key prop ä½¿ç”¨

---

### 2.2 TypeScript Strict Mode

**ç”¨é€”ï¼š** å‹åˆ¥å®‰å…¨ï¼Œæ¸›å°‘åŸ·è¡Œæ™‚éŒ¯èª¤

**è¨­å®šï¼š**
```json
// tsconfig.json
{
  "compilerOptions": {
    "strict": true,
    "noImplicitAny": true,
    "strictNullChecks": true,
    "strictFunctionTypes": true,
    "strictBindCallApply": true,
    "strictPropertyInitialization": true,
    "noImplicitThis": true,
    "alwaysStrict": true
  }
}
```

---

## 3. å„ªåŒ–å¥—ä»¶

### 3.1 React.memo / useMemo / useCallback

**å…§å»º React APIï¼Œç„¡éœ€å®‰è£**

**ä½¿ç”¨ç¯„ä¾‹ï¼š**

```tsx
// React.memo - çµ„ä»¶è¨˜æ†¶åŒ–
import { memo } from 'react';

const SearchBarFields = memo<SearchBarFieldsProps>(({ 
  departmentOptions,
  workHoursTypeOptions,
  isDepartmentsLoading,
}) => {
  // ... çµ„ä»¶é‚è¼¯
});

// useMemo - å€¼è¨˜æ†¶åŒ–
const viewModeOptions = useMemo(() => 
  VIEW_MODE_OPTIONS.map(opt => ({ ...opt, label: t(opt.label) })),
  [t]
);

// useCallback - å‡½æ•¸è¨˜æ†¶åŒ–
const renderCalendar = useCallback(() => {
  if (isLoading) return <LoadingState />;
  if (hasScheduleData) return <ScheduleCalendar days={scheduleDays} />;
  return <EmptyState />;
}, [isLoading, hasScheduleData, scheduleDays]);
```

---

### 3.2 React Window / React Virtualized

**ç”¨é€”ï¼š** è™›æ“¬åŒ–é•·åˆ—è¡¨ï¼Œåªæ¸²æŸ“å¯è¦‹é …ç›®

**å®‰è£ï¼š**
```bash
npm install react-window
# or
npm install react-virtualized
```

**ä½¿ç”¨ç¯„ä¾‹ï¼ˆé©ç”¨æ–¼å¤§é‡å“¡å·¥åˆ—è¡¨ï¼‰ï¼š**
```tsx
import { FixedSizeList } from 'react-window';

const EmployeeList: React.FC<{ employees: Employee[] }> = ({ employees }) => {
  const Row = ({ index, style }: { index: number; style: React.CSSProperties }) => (
    <div style={style}>
      <EmployeeRow employee={employees[index]} />
    </div>
  );

  return (
    <FixedSizeList
      height={600}
      itemCount={employees.length}
      itemSize={50}
      width="100%"
    >
      {Row}
    </FixedSizeList>
  );
};
```

**æ•ˆèƒ½æå‡ï¼š**
- 1000+ é …ç›®åˆ—è¡¨ï¼šæå‡ 80-90% æ¸²æŸ“é€Ÿåº¦
- è¨˜æ†¶é«”ä½¿ç”¨ï¼šæ¸›å°‘ 70-80%

---

### 3.3 Immer

**ç”¨é€”ï¼š** ä¸å¯è®Šæ•¸æ“šæ›´æ–°ï¼Œç°¡åŒ–ç‹€æ…‹ç®¡ç†

**å®‰è£ï¼š**
```bash
npm install immer
```

**ä½¿ç”¨ç¯„ä¾‹ï¼š**
```tsx
import { produce } from 'immer';

// å‚³çµ±æ–¹å¼ï¼ˆå®¹æ˜“å‡ºéŒ¯ï¼‰
const updateSchedule = (schedule: Schedule, updates: Partial<Schedule>) => {
  return {
    ...schedule,
    shifts: schedule.shifts.map(shift => 
      shift.id === updates.id ? { ...shift, ...updates } : shift
    ),
  };
};

// ä½¿ç”¨ Immerï¼ˆæ›´ç°¡æ½”ã€æ›´å®‰å…¨ï¼‰
const updateSchedule = (schedule: Schedule, updates: Partial<Schedule>) => {
  return produce(schedule, draft => {
    const shift = draft.shifts.find(s => s.id === updates.id);
    if (shift) {
      Object.assign(shift, updates);
    }
  });
};
```

---

### 3.4 React Query / SWR

**ç”¨é€”ï¼š** æ•¸æ“šç²å–å’Œå¿«å–å„ªåŒ–

**å°ˆæ¡ˆå·²ä½¿ç”¨ React Query (@tanstack/react-query)**

**å„ªåŒ–å»ºè­°ï¼š**
```tsx
// ä½¿ç”¨ staleTime å’Œ cacheTime å„ªåŒ–
const { data: scheduleData } = useQuery({
  queryKey: ['shiftSchedule', params],
  queryFn: () => fetchShiftSchedule(params),
  staleTime: 5 * 60 * 1000, // 5 åˆ†é˜å…§ä¸é‡æ–°ç²å–
  cacheTime: 10 * 60 * 1000, // å¿«å–ä¿ç•™ 10 åˆ†é˜
  refetchOnWindowFocus: false, // è¦–çª—èšç„¦æ™‚ä¸é‡æ–°ç²å–
});

// ä½¿ç”¨ prefetch é å…ˆè¼‰å…¥æ•¸æ“š
const queryClient = useQueryClient();
queryClient.prefetchQuery({
  queryKey: ['shiftSchedule', nextParams],
  queryFn: () => fetchShiftSchedule(nextParams),
});
```

---

## 4. æ¸¬è©¦å·¥å…·

### 4.1 React Testing Library

**ç”¨é€”ï¼š** çµ„ä»¶æ¸¬è©¦ï¼Œç¢ºä¿å„ªåŒ–ä¸å½±éŸ¿åŠŸèƒ½

**å®‰è£ï¼š**
```bash
npm install --save-dev @testing-library/react @testing-library/jest-dom
```

**æ•ˆèƒ½æ¸¬è©¦ç¯„ä¾‹ï¼š**
```tsx
import { render, screen } from '@testing-library/react';
import { ShiftScheduleApprovalView } from './ShiftScheduleApprovalView';

describe('ShiftScheduleApprovalView Performance', () => {
  it('should not re-render when props do not change', () => {
    const props = {
      isPageLoading: false,
      hasNoData: false,
      // ... å…¶ä»– props
    };

    const { rerender } = render(<ShiftScheduleApprovalView {...props} />);
    
    // ä½¿ç”¨ç›¸åŒ props é‡æ–°æ¸²æŸ“
    const renderCount = jest.fn();
    rerender(<ShiftScheduleApprovalView {...props} />);
    
    // é©—è­‰çµ„ä»¶æ²’æœ‰ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“
    expect(renderCount).not.toHaveBeenCalled();
  });
});
```

---

### 4.2 Lighthouse

**ç”¨é€”ï¼š** ç¶²é æ•ˆèƒ½è©•åˆ†

**ä½¿ç”¨æ–¹å¼ï¼š**
1. é–‹å•Ÿ Chrome DevTools
2. åˆ‡æ›åˆ° "Lighthouse" æ¨™ç±¤
3. é¸æ“‡ "Performance" é¡åˆ¥
4. é»æ“Š "Generate report"

**é—œéµæŒ‡æ¨™ï¼š**
- **FCP** (First Contentful Paint) - é¦–æ¬¡å…§å®¹ç¹ªè£½
- **LCP** (Largest Contentful Paint) - æœ€å¤§å…§å®¹ç¹ªè£½
- **TBT** (Total Blocking Time) - ç¸½é˜»å¡æ™‚é–“
- **CLS** (Cumulative Layout Shift) - ç´¯ç©ä½ˆå±€åç§»

**ç›®æ¨™åˆ†æ•¸ï¼š**
- Performance: 90+
- Accessibility: 90+
- Best Practices: 90+

---

## 5. ç›£æ§å·¥å…·

### 5.1 Sentry Performance Monitoring

**ç”¨é€”ï¼š** ç”Ÿç”¢ç’°å¢ƒæ•ˆèƒ½ç›£æ§

**å®‰è£ï¼š**
```bash
npm install @sentry/react
```

**è¨­å®šï¼š**
```tsx
import * as Sentry from "@sentry/react";

Sentry.init({
  dsn: "YOUR_SENTRY_DSN",
  integrations: [
    new Sentry.BrowserTracing(),
  ],
  tracesSampleRate: 0.1, // 10% çš„äº¤æ˜“é€²è¡Œè¿½è¹¤
});

// è¿½è¹¤ç‰¹å®šæ“ä½œ
const transaction = Sentry.startTransaction({
  name: "Load Shift Schedule",
});

// ... åŸ·è¡Œæ“ä½œ

transaction.finish();
```

---

### 5.2 Web Vitals

**ç”¨é€”ï¼š** è¿½è¹¤æ ¸å¿ƒç¶²é æŒ‡æ¨™

**å®‰è£ï¼š**
```bash
npm install web-vitals
```

**ä½¿ç”¨ï¼š**
```tsx
import { getCLS, getFID, getFCP, getLCP, getTTFB } from 'web-vitals';

const reportWebVitals = (metric: any) => {
  console.log(metric);
  // ç™¼é€åˆ°åˆ†ææœå‹™
};

getCLS(reportWebVitals);
getFID(reportWebVitals);
getFCP(reportWebVitals);
getLCP(reportWebVitals);
getTTFB(reportWebVitals);
```

---

## 6. å¯¦ä½œå»ºè­°

### 6.1 ShiftScheduleApproval å„ªåŒ–å·¥å…·çµ„åˆ

**éšæ®µä¸€ï¼šåˆ†æéšæ®µ**
```bash
# 1. å®‰è£åˆ†æå·¥å…·
npm install --save-dev @welldone-software/why-did-you-render

# 2. è¨­å®š wdyr.ts
# 3. ä½¿ç”¨ React DevTools Profiler éŒ„è£½
# 4. ä½¿ç”¨ Chrome Performance åˆ†æ
```

**éšæ®µäºŒï¼šå„ªåŒ–éšæ®µ**
```bash
# 1. æ‡‰ç”¨ React.memo / useMemo / useCallback
# 2. æå–å¸¸é‡å’Œçµ„ä»¶
# 3. ä½¿ç”¨ ESLint æª¢æŸ¥
```

**éšæ®µä¸‰ï¼šé©—è­‰éšæ®µ**
```bash
# 1. å†æ¬¡ä½¿ç”¨ Profiler æ¯”è¼ƒ
# 2. åŸ·è¡Œ Lighthouse æ¸¬è©¦
# 3. ç·¨å¯«æ•ˆèƒ½æ¸¬è©¦
```

---

### 6.2 æ•ˆèƒ½å„ªåŒ–æª¢æŸ¥æ¸…å–®

#### çµ„ä»¶å±¤ç´š
- [ ] ä½¿ç”¨ `React.memo` åŒ…è£¹ç´”å±•ç¤ºçµ„ä»¶
- [ ] ä½¿ç”¨ `useCallback` åŒ…è£¹äº‹ä»¶è™•ç†å‡½æ•¸
- [ ] ä½¿ç”¨ `useMemo` å¿«å–è¨ˆç®—çµæœ
- [ ] é¿å…å…§è¯å°è±¡å’Œé™£åˆ—å‰µå»º
- [ ] æå–å¸¸é‡åˆ°çµ„ä»¶å¤–éƒ¨

#### æ•¸æ“šå±¤ç´š
- [ ] é…ç½® React Query å¿«å–ç­–ç•¥
- [ ] ä½¿ç”¨ `staleTime` æ¸›å°‘é‡è¤‡è«‹æ±‚
- [ ] å¯¦ä½œæ¨‚è§€æ›´æ–° (Optimistic Updates)
- [ ] ä½¿ç”¨ `prefetch` é è¼‰æ•¸æ“š

#### æ¸²æŸ“å±¤ç´š
- [ ] æ¢ä»¶æ¸²æŸ“æ”¹ç‚ºæ§åˆ¶ props
- [ ] å¤§åˆ—è¡¨ä½¿ç”¨è™›æ“¬åŒ–
- [ ] åœ–ç‰‡ä½¿ç”¨æ‡¶åŠ è¼‰
- [ ] ä»£ç¢¼åˆ†å‰² (Code Splitting)

#### ç›£æ§å±¤ç´š
- [ ] è¨­å®š Sentry æ•ˆèƒ½ç›£æ§
- [ ] è¿½è¹¤ Web Vitals
- [ ] å®šæœŸåŸ·è¡Œ Lighthouse æ¸¬è©¦
- [ ] å»ºç«‹æ•ˆèƒ½åŸºæº–ç·š

---

### 6.3 æ•ˆèƒ½é ç®—

**ç‚º ShiftScheduleApproval è¨­å®šæ•ˆèƒ½é ç®—ï¼š**

| æŒ‡æ¨™ | ç›®æ¨™ | è­¦å‘Š | éŒ¯èª¤ |
|------|------|------|------|
| é¦–æ¬¡æ¸²æŸ“æ™‚é–“ | < 1s | 1-2s | > 2s |
| çµ„ä»¶æ›´æ–°æ™‚é–“ | < 100ms | 100-200ms | > 200ms |
| è¨˜æ†¶é«”ä½¿ç”¨ | < 50MB | 50-100MB | > 100MB |
| Bundle å¤§å° | < 500KB | 500KB-1MB | > 1MB |
| Lighthouse åˆ†æ•¸ | > 90 | 80-90 | < 80 |

---

## ğŸ“š åƒè€ƒè³‡æº

### å®˜æ–¹æ–‡æª”
- [React DevTools](https://react.dev/learn/react-developer-tools)
- [React Profiler API](https://react.dev/reference/react/Profiler)
- [Web Vitals](https://web.dev/vitals/)

### å·¥å…·æ–‡æª”
- [Why Did You Render](https://github.com/welldone-software/why-did-you-render)
- [React Window](https://react-window.vercel.app/)
- [Sentry Performance](https://docs.sentry.io/product/performance/)

### æœ€ä½³å¯¦è¸
- [React Performance Optimization](https://react.dev/learn/render-and-commit)
- [Optimizing Performance](https://legacy.reactjs.org/docs/optimizing-performance.html)

---

**æ–‡ä»¶ç¶­è­·è€…ï¼š** AI Assistant  
**æœ€å¾Œæ›´æ–°ï¼š** 2025-10-14  
**ç‰ˆæœ¬ï¼š** v1.0

